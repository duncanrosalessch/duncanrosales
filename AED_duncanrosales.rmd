---
title: "Análisis exploratorio de datos de fitoplancton encontrado en canales Baker y Martinez, bajo CIMAR Fiordo N°20"
author: "Duncan Rosales Schulz"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)
#Cargar las librerías asociadas al trabajo de los datos
library(readxl)
library(graphics)
library(psych)
library(stats)
library(dplyr)
library(tidyr)
library(ggplot2)
```

#**CONSIDERACIONES INICIALES**

```{r}
#Montando la base de datos necesaria para realizar el análisis exploratorio
dat <- read_excel("BD_FITO_DIATOMEAS.xlsx")
#Debido a que al parecer es un real problema tener muchas observaciones en 0, cosa que para usar PRIMER si era muy útil, procederé a borrar aquellos registros que tengan abundancia ">0"
df2<-subset(dat, ABUNDANCIA!="0")
df2
```

#**Variables cuantitativas y factores**

La variable cuantitativa, en este estudio, se trató de una cuantitativa de tipo discreta: ABUNDANCIA.

Los factores, que son varios, son los siguientes: ESPECIE, TIPO, PROFUNDIDAD, CANAL, ESTACION.

```{r, warning=FALSE,message=FALSE}
#Haciendo las respectivas transformaciones a factor
df2$CANAL <- as.factor(df2$CANAL)
df2$ESTACIÓN <- as.factor(df2$ESTACIÓN)
df2$ESPECIE <- as.factor(df2$ESPECIE)
df2$PROFUNDIDAD <- as.factor(df2$PROFUNDIDAD)
df2$TIPO <- as.factor(df2$TIPO)
```

```{r}
summary(df2)
head(df2)
str(df2)
```
**BALANCE DE DATOS Y VERIFICACIÓN DE DATOS**

Tabla de frecuencia sobre factores de clasificacion con función table(), sobre la variable ABUNDANCIA.

```{r}
#Averiguar si los datos se encuentran balanceados, y si cuentan con .
table(df2$ABUNDANCIA)
```

#**HISTOGRAMA**

Como primera aproximación, se realizó un histograma de la distribución de frecuencia, de la variable ABUNDANCIA.

```{r}
hist(df2$ABUNDANCIA, main= "Histograma", xlab= "Abundancia", ylab= "Frecuencia", ylim= c(0,1000),col="yellow")
```


Se decidió mostrar la distribución de frecuencia de la variable ABUNDANCIA, separada entre DIATOMEAS y DINOFLAGELADOS.

```{r}
#Aquí realizo un histograma
Diatomeas <- df2 %>% filter(TIPO=="DIATOMEAS")
Dinoflagelados <- df2 %>% filter(TIPO=="DINOFLAGELADOS")
par(mfrow = c(1,2))
hist(Diatomeas$ABUNDANCIA, main= "Hist Diatomeas", xlab= "Abundancia", ylab = "Frecuencia", ylim= c(0,800),col="cyan")
hist(Dinoflagelados$ABUNDANCIA, main= "Hist Dinoflagelados", xlab= "Abundancia", ylab= "Frecuencia", ylim= c(0,350),col="green")
```

#**RELACIÓN ENTRE VARIABLES Y FACTORES**

Se realizaron gráficos boxplot entre ABUNDANCIA, variable respuesta, y los factores o variables regresoras.

```{r}
df2%>% 
  ggplot(aes(x=CANAL,y=ABUNDANCIA))+
      geom_boxplot()+
     theme(legend.position="none")+
     labs(x="Canal",y="Abundancia",title="Relación ABUNDANCIA y CANAL")

df2%>% 
  ggplot(aes(x=PROFUNDIDAD,y=ABUNDANCIA))+
      geom_boxplot()+
     theme(legend.position="none")+
     labs(x="Profundidad",y="Abundancia",title="Relación ABUNDANCIA y PROFUNDIDAD")

df2%>% 
  ggplot(aes(x=ESTACIÓN,y=ABUNDANCIA))+
      geom_boxplot()+
     theme(legend.position="none")+
     labs(x="Estación",y="Abundancia",title="Relación ABUNDANCIA y ESTACIÓN")
```
#**OTROS**

A continuación, algunos análisis adicionales que estoy pensando en hacer, pero no considerar todavía como finales.

```{r}
#ABUNDANCIA + CANAL
ggplot(df2, aes(x= 'TIPO', y= 'ABUNDANCIA', fill=TIPO))+
geom_col()+facet_wrap(~ CANAL)
```

```{r}
#Acá, me gustaría poder sacar tablas de cada grupo
T_abu_DIATO <- df2 %>% filter(TIPO=="DIATOMEAS") %>% summarise(mean = mean(ABUNDANCIA), sd = sd(ABUNDANCIA), max(ABUNDANCIA), min (ABUNDANCIA))

knitr::kable(T_abu_DIATO, caption = "Tabla 1. Resumen de la abundancia de diatomeas")

T_abu_DINO <- df2 %>% filter(TIPO=="DINOFLAGELADOS") %>% summarise(mean = mean(ABUNDANCIA), sd = sd(ABUNDANCIA), max(ABUNDANCIA), min (ABUNDANCIA))

knitr::kable(T_abu_DINO, caption = "Tabla 2. Resumen de la abundancia de dinoflagelados")
```


```{r}
Tabla_abu <- df2 %>% group_by(CANAL,PROFUNDIDAD,TIPO) %>% summarise(mean = mean(ABUNDANCIA), sd = sd(ABUNDANCIA), n=n())

knitr::kable(Tabla_abu, caption = "Tabla 1. Resumen de la abundancia de fitoplancton, por canal y profundidad")
```


